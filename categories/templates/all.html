{% extends 'base.html' %}

{% block content %}

<h1 class="text-5xl font-bold mb-4 text-center">Books in All Category</h1>

<div class="flex items-center justify-center py-4 md:py-8 flex-wrap">
    <button data-category="all" type="button" class="category-button text-blue-700 hover:text-white border border-blue-600 bg-white hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:bg-gray-900 dark:focus:ring-blue-800">All categories</button>
    <button data-category="Art" type="button" class="category-button text-gray-900 border border-white hover:border-gray-200 dark:border-gray-900 dark:bg-gray-900 dark:hover:border-gray-700 bg-white focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:text-white dark:focus:ring-gray-800">Art</button>
    <button data-category="Economics" type="button" class="category-button text-gray-900 border border-white hover:border-gray-200 dark:border-gray-900 dark:bg-gray-900 dark:hover:border-gray-700 bg-white focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:text-white dark:focus:ring-gray-800">Economics</button>
    <button data-category="Fiction" type="button" class="category-button text-gray-900 border border-white hover:border-gray-200 dark:border-gray-900 dark:bg-gray-900 dark:hover:border-gray-700 bg-white focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:text-white dark:focus:ring-gray-800">Fiction</button>
    <button data-category="History" type="button" class="category-button text-gray-900 border border-white hover:border-gray-200 dark:border-gray-900 dark:bg-gray-900 dark:hover:border-gray-700 bg-white focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:text-white dark:focus:ring-gray-800">History</button>
    <button data-category="Philosophy" type="button" class="category-button text-gray-900 border border-white hover:border-gray-200 dark:border-gray-900 dark:bg-gray-900 dark:hover:border-gray-700 bg-white focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:text-white dark:focus:ring-gray-800">Philosophy</button>
    <button data-category="Science" type="button" class="category-button text-gray-900 border border-white hover:border-gray-200 dark:border-gray-900 dark:bg-gray-900 dark:hover:border-gray-700 bg-white focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-full text-base font-medium px-5 py-2.5 text-center mr-3 mb-3 dark:text-white dark:focus:ring-gray-800">Science</button>
</div>

<div id="books_list" class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
</div>

<script>
    const bookBaseURL = "/book/";

    async function getBooks() {
        return fetch("{% url 'categories:get_book_json_all' %}").then((res) => res.json())
    }

    async function refreshBooks() {
        document.getElementById("books_list").innerHTML = "";
        const books = await getBooks();
        let htmlString = "";
        books.forEach((item) => {
            const truncatedDescription = item.fields.description.split(" ").slice(0, 30).join(" ") + (item.fields.description.split(" ").length > 30 ? "..." : "");
            const bookUrl = `${bookBaseURL}${item.pk}/`;
            htmlString += `
                <div class="group relative">
                    <a href="${bookUrl}" class="block">
                        <img class="w-full rounded-lg" src="${item.fields.image_link}" alt="${item.fields.title}">
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 p-2 text-white text-xs rounded-b-lg transition-opacity opacity-0 group-hover:opacity-100">
                            <strong>${item.fields.title} by ${item.fields.author}</strong><br>
                            ${truncatedDescription}
                        </div>
                    </a>
                </div>
                `;
        });
        document.getElementById("books_list").innerHTML = htmlString;
    }
    refreshBooks()
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        let buttons = document.querySelectorAll('.category-button');
    
        buttons.forEach(button => {
            button.addEventListener('click', function() {
                let categoryName = button.getAttribute('data-category');
                if (categoryName === 'all') {
                    window.location.href = `../all/`;
                }else {
                    window.location.href = `{% url 'categories:books_by_category' category_name='temp' %}`.replace('temp', categoryName);
                }
            });
        });
    });
</script>
    

{% endblock content %}
